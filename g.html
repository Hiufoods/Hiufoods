<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets Form</title>
    <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
    <h2>Google Sheets Form</h2>

    <!-- Login Button -->
    <button id="login-button" onclick="handleLogin()">Login with Google</button>
    <button id="logout-button" style="display:none;" onclick="handleLogout()">Logout</button>

    <form id="data-form" onsubmit="handleSubmit(event)">
        <div>
            <label for="name">Name:</label>
            <input type="text" id="name" name="name" placeholder="Enter your name" required>
        </div>
        <div>
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" placeholder="Enter your email" required>
        </div>
        <button type="submit">Submit</button>
    </form>

    <script>
        // Define your API Key and Client ID here
        const API_KEY = 'AIzaSyCOZQaLnFsExxn0D7G47bPZsY7xWSyPing';  // Replace with your API key
        const CLIENT_ID = '275848878415-1tbcmsagsu1onk27l87oc1s9ro8t2ub0.apps.googleusercontent.com';  // Replace with your OAuth client ID
        const SPREADSHEET_ID = '1pcMc-dmdk-0fcii-Cb7nPTmY6R6BZLJRtxv5P96l7V0';  // Replace with your spreadsheet ID
        const RANGE = 'Sheet1!A:B';  // Replace with the range you want to use
 
        let isAuthenticated = false;

        // Initialize Google API client
        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                scope: "https://www.googleapis.com/auth/spreadsheets",
            }).then(() => {
                gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
                updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
            });
        }

        // Load the API client and authenticate
        function loadGapi() {
            gapi.load('client:auth2', initClient);
        }

        // Update login/logout status
        function updateSigninStatus(isSignedIn) {
            isAuthenticated = isSignedIn;
            if (isSignedIn) {
                document.getElementById('login-button').style.display = 'none';
                document.getElementById('logout-button').style.display = 'block';
                document.getElementById('data-form').style.display = 'block';
            } else {
                document.getElementById('login-button').style.display = 'block';
                document.getElementById('logout-button').style.display = 'none';
                document.getElementById('data-form').style.display = 'none';
            }
        }

        // Handle login
        function handleLogin() {
            gapi.auth2.getAuthInstance().signIn();
        }

        // Handle logout
        function handleLogout() {
            gapi.auth2.getAuthInstance().signOut();
        }

        // Submit form data to Google Sheets
        function handleSubmit(event) {
            event.preventDefault();
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;

            // Append data to Google Sheets
            appendDataToSheet(name, email);
        }

        // Append data to Google Sheets
        function appendDataToSheet(name, email) {
            const params = {
                spreadsheetId: SPREADSHEET_ID,
                range: RANGE,
                valueInputOption: "RAW",
                requestBody: {
                    values: [[name, email]],
                },
            };

            gapi.client.sheets.spreadsheets.values.append(params)
                .then((response) => {
                    console.log('Data added to Google Sheets:', response);
                    alert('Data added successfully!');
                }).catch((error) => {
                    console.error('Error adding data:', error);
                    alert('Failed to add data.');
                });
        }

        // Load Google API client
        loadGapi();
    </script>
</body>
</html>
